[pytest]
# Pytest configuration for Empathy Framework

# Test discovery
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths = tests

# Ensure pytest imports from src/ instead of stale site-packages installs
pythonpath = src

# Default options (for unit tests)
# -n 0: Sequential execution (parallel disabled to avoid import timing issues)
# --maxfail=20: Stop after 20 failures (fail fast)
# NOTE: Parallel execution disabled due to import timing issues with workflows package
# Exclude pre-existing/new failing tests (tracked for v4.0.3)
addopts =
    --verbose
    --tb=short
    --strict-markers
    -n 0
    --maxfail=20
    --ignore=tests/test_base_wizard_exceptions.py
    --ignore=tests/test_wizard_api_integration.py
    --ignore=tests/unit/memory/test_memory_architecture.py
    --ignore=tests/unit/models/test_execution_and_fallback_architecture.py
    --ignore=tests/unit/orchestration/test_composition_patterns.py
    --ignore=tests/integration/
    --ignore=tests/test_llm_integration.py
    --ignore=tests/unit/orchestration/test_execution_strategies.py
    --ignore=tests/unit/workflows/test_orchestrated_release_prep.py
    --ignore=tests/unit/security/test_scanner_phase3_ast.py
    --ignore=tests/unit/scaffolding/test_scaffolding_cli.py

# Asyncio settings (pytest-asyncio 1.3.0+)
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function
asyncio_default_test_loop_scope = function

# Markers (for categorizing tests)
markers =
    smoke: critical smoke tests for quick validation (run with '-m smoke')
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: integration tests that run CLI via subprocess (no coverage)
    unit: unit tests that import modules directly (measured for coverage)
    security: security-related tests
    performance: performance-related tests
    llm: tests that require LLM API access
    network: tests that require network/internet access (skip in CI with '-m "not network"')
    behavioral: behavioral tests (generated, user-facing behavior)
    cli: CLI command tests (require mocking)
    refactored: tests for refactored modules (batch11, batch12, batch13)

# Ignore paths
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    .venv
    venv
    env
    backend
    wizards
    anthropic-cookbook
    10_9_2025_ai_nurse_florence
    salvaged
    site
    ebook-site
    website
    examples/coach/lsp
    vscode-extension

# Warnings
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ImportWarning

# Output
console_output_style = progress
junit_family = xunit2
