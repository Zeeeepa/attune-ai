{
  "template_id": "python_package_publish",
  "name": "Python Package Publishing Workflow",
  "description": "End-to-end workflow for publishing Python packages to PyPI with quality checks",
  "version": "1.0.0",
  "tags": ["python", "publishing", "ci-cd", "quality-assurance"],
  "author": "system",
  "estimated_cost_range": [0.05, 0.30],
  "estimated_duration_minutes": 8,

  "form_schema": {
    "title": "Python Package Publishing Configuration",
    "description": "Answer these questions to configure your publishing workflow",
    "questions": [
      {
        "id": "package_name",
        "text": "What is your package name?",
        "type": "text_input",
        "options": [],
        "default": null,
        "help_text": "The name used in setup.py/pyproject.toml",
        "required": true
      },
      {
        "id": "has_tests",
        "text": "Does your package have tests?",
        "type": "boolean",
        "options": [],
        "default": "Yes",
        "help_text": "We'll run pytest if available",
        "required": true
      },
      {
        "id": "test_coverage_required",
        "text": "What minimum test coverage do you require?",
        "type": "single_select",
        "options": ["None", "60%", "70%", "80%", "90%"],
        "default": "80%",
        "help_text": "Minimum coverage threshold",
        "required": true
      },
      {
        "id": "quality_checks",
        "text": "Which quality checks should we run?",
        "type": "multi_select",
        "options": [
          "Type checking (mypy)",
          "Linting (ruff)",
          "Security scan (bandit)",
          "Dependency audit",
          "Documentation build"
        ],
        "default": null,
        "help_text": "Select all that apply",
        "required": false
      },
      {
        "id": "version_bump",
        "text": "How should we bump the version?",
        "type": "single_select",
        "options": ["patch", "minor", "major", "manual"],
        "default": "patch",
        "help_text": "Semantic versioning increment",
        "required": true
      },
      {
        "id": "publish_to",
        "text": "Where should we publish?",
        "type": "single_select",
        "options": ["PyPI (production)", "TestPyPI (staging)", "Skip publishing"],
        "default": "TestPyPI (staging)",
        "help_text": "Publication target",
        "required": true
      },
      {
        "id": "create_git_tag",
        "text": "Create git tag for release?",
        "type": "boolean",
        "options": [],
        "default": "Yes",
        "help_text": "Tag the release in git",
        "required": true
      },
      {
        "id": "update_changelog",
        "text": "Auto-update CHANGELOG.md?",
        "type": "boolean",
        "options": [],
        "default": "Yes",
        "help_text": "Generate changelog entry",
        "required": true
      }
    ]
  },

  "agent_composition_rules": [
    {
      "role": "test_runner",
      "base_template": "test_coverage_analyzer",
      "tier_strategy": "cheap_only",
      "tools": ["pytest", "coverage"],
      "required_responses": {
        "has_tests": "Yes"
      },
      "config_mapping": {
        "test_coverage_required": "min_coverage"
      },
      "success_criteria": [
        "All tests pass",
        "Coverage meets minimum threshold"
      ]
    },
    {
      "role": "type_checker",
      "base_template": "code_reviewer",
      "tier_strategy": "cheap_only",
      "tools": ["mypy"],
      "required_responses": {
        "quality_checks": "Type checking (mypy)"
      },
      "config_mapping": {},
      "success_criteria": [
        "No type errors"
      ]
    },
    {
      "role": "linter",
      "base_template": "code_reviewer",
      "tier_strategy": "cheap_only",
      "tools": ["ruff"],
      "required_responses": {
        "quality_checks": "Linting (ruff)"
      },
      "config_mapping": {},
      "success_criteria": [
        "No linting errors",
        "Code formatted correctly"
      ]
    },
    {
      "role": "security_auditor",
      "base_template": "security_auditor",
      "tier_strategy": "progressive",
      "tools": ["bandit", "safety"],
      "required_responses": {
        "quality_checks": "Security scan (bandit)"
      },
      "config_mapping": {},
      "success_criteria": [
        "No high-severity vulnerabilities",
        "Dependencies are secure"
      ]
    },
    {
      "role": "version_manager",
      "base_template": "generic",
      "tier_strategy": "cheap_only",
      "tools": ["bump2version", "git"],
      "required_responses": {},
      "config_mapping": {
        "version_bump": "bump_type"
      },
      "success_criteria": [
        "Version bumped correctly",
        "Git tag created (if requested)"
      ]
    },
    {
      "role": "changelog_updater",
      "base_template": "documentation_writer",
      "tier_strategy": "capable_first",
      "tools": ["file_editor"],
      "required_responses": {
        "update_changelog": "Yes"
      },
      "config_mapping": {},
      "success_criteria": [
        "CHANGELOG.md updated with new version",
        "Changes documented clearly"
      ]
    },
    {
      "role": "package_builder",
      "base_template": "generic",
      "tier_strategy": "cheap_only",
      "tools": ["build", "twine"],
      "required_responses": {},
      "config_mapping": {},
      "success_criteria": [
        "Package builds successfully",
        "Distribution files created"
      ]
    },
    {
      "role": "publisher",
      "base_template": "generic",
      "tier_strategy": "progressive",
      "tools": ["twine"],
      "required_responses": {
        "publish_to": ["PyPI (production)", "TestPyPI (staging)"]
      },
      "config_mapping": {
        "publish_to": "repository"
      },
      "success_criteria": [
        "Package uploaded successfully",
        "Version available on repository"
      ]
    }
  ]
}
