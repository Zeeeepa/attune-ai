---
description: Attune AI v2.3 - Memory Enhancement Release: **Date:** December 18, 2025 This release adds three major features for distributed agent coordination and C
---

# Attune AI v2.3 - Memory Enhancement Release

**Date:** December 18, 2025

This release adds three major features for distributed agent coordination and Claude Code integration:

## 1. Conversation Summary Index

**Location:** `src/attune/memory/summary_index.py`

Redis-backed conversation summary with topic indexing for efficient agent handoffs.

### Key Benefits
- **80% token savings** vs full conversation history
- **8x faster** sub-agent startup (200-400ms vs 2-3s)
- **Cross-session intelligence** - recall decisions from past sessions
- **Intelligent filtering** by focus topics

### Usage

```python
from attune.memory import (
    ConversationSummaryIndex,
    RedisShortTermMemory,
)

# Initialize
redis = RedisShortTermMemory()  # or use_mock=True for testing
index = ConversationSummaryIndex(redis)

# Update summary incrementally
index.update_summary("session123", {
    "type": "decision",
    "content": "Use JWT for authentication"
})

# Get compact context for sub-agent (filtered by topic)
context = index.get_context_for_agent(
    "session123",
    focus_topics=["auth", "security"]
)

# Inject into prompt (~2,000 tokens instead of 50,000+)
prompt = f"Previous context:\n{context.to_prompt()}\n\nTask: ..."

# Cross-session decision recall
decisions = index.recall_decisions("authentication", days_back=7)
```

### Event Types
- `started` / `in_progress` - Updates working_on field
- `decision` - Adds to decisions list
- `question` - Adds to open_questions
- `answered` - Removes answered question
- `file_modified` - Tracks key files
- `completed` - Adds to timeline

---

## 2. CLAUDE.md Auto-Sync

**Location:** `attune_llm/cli/sync_claude.py`
**Command:** `empathy-sync-claude`

Syncs learned patterns to Claude Code's `.claude/rules/attune/` for native integration.

### Usage

```bash
# One-time sync
empathy-sync-claude

# Watch for changes and auto-sync
empathy-sync-claude --watch

# Preview without writing
empathy-sync-claude --dry-run --verbose
```

### Output Structure

```
.claude/rules/attune/
├── bug-patterns.md          # From patterns/debugging/
├── security-decisions.md    # From patterns/security/
├── tech-debt-hotspots.md    # From patterns/tech_debt/
└── coding-patterns.md       # From patterns/inspection/
```

### Example Output (bug-patterns.md)

```markdown
---
paths: **/*.py, **/*.js, **/*.ts
---

# Bug Patterns (Auto-generated by Empathy)
Last sync: 2025-12-18 23:11

## Null Reference Bugs

### When you see: `TypeError: Cannot read property 'map' of undefined`
**Root cause:** API returned null instead of empty array
**Fix:** Added default empty array fallback: data?.items ?? []
```

---

## 3. Smart Model Router

**Location:** `attune_llm/routing/model_router.py`

Routes tasks to appropriate model tiers for cost optimization.

### Model Tiers

| Tier | Anthropic | OpenAI | Cost (approx) |
|------|-----------|--------|---------------|
| CHEAP | claude-3-5-haiku | gpt-4o-mini | $0.25-1.25/M |
| CAPABLE | claude-sonnet-4 | gpt-4o | $3-15/M |
| PREMIUM | claude-opus-4 | o1 | $15-75/M |

### Task Routing

```python
# CHEAP tasks: summarize, classify, triage, match_pattern
# CAPABLE tasks: generate_code, fix_bug, review_security, write_tests
# PREMIUM tasks: coordinate, synthesize_results, architectural_decision
```

### Usage

```python
from attune_llm.routing import ModelRouter

router = ModelRouter()

# Get model for task type
model = router.route("summarize")      # → claude-3-5-haiku
model = router.route("fix_bug")        # → claude-sonnet-4
model = router.route("coordinate")     # → claude-opus-4

# Estimate costs
cost = router.estimate_cost("fix_bug", input_tokens=5000, output_tokens=1000)
print(f"Estimated: ${cost:.4f}")

# Compare costs across tiers
costs = router.compare_costs("fix_bug", 5000, 1000)
# {'cheap': $0.003, 'capable': $0.03, 'premium': $0.225}

# Calculate savings vs always using premium
savings = router.calculate_savings("summarize", 10000, 2000)
print(f"Savings: {savings['savings_percent']:.0f}%")  # ~95%
```

### Cost Savings Example

**Complex task: Review PR for security, performance, and test coverage**

| Approach | Cost |
|----------|------|
| All Premium (Opus) | $4.05 |
| Smart Routing | $0.83 |
| **Savings** | **$3.22 (80%)** |

At 100 tasks/day = **$9,660/month saved**

---

## Test Coverage

| Test Suite | Tests | Status |
|------------|-------|--------|
| `test_summary_index.py` | 18 | ✅ Pass |
| `test_model_router.py` | 28 | ✅ Pass |
| `test_unified_memory.py` | 59 | ✅ Pass |
| `test_redis_memory.py` | 35 | ✅ Pass |
| **Total** | **140** | ✅ Pass |

---

## Installation

These features are included in `attune-ai>=2.3.0`:

```bash
pip install attune-ai --upgrade
```

---

## Architecture Integration

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     EMPATHY MEMORY ARCHITECTURE                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    COORDINATOR (Premium)                         │   │
│  │   • Task decomposition    • Result synthesis                    │   │
│  │   • Budget: 50k tokens    • Model: Opus/o1                      │   │
│  └──────────────────────────────┬──────────────────────────────────┘   │
│                                 │                                       │
│         ┌───────────────────────┼───────────────────────┐              │
│         ▼                       ▼                       ▼              │
│  ┌─────────────┐         ┌─────────────┐         ┌─────────────┐      │
│  │ Sub-Agent 1 │         │ Sub-Agent 2 │         │ Sub-Agent 3 │      │
│  │  (Capable)  │         │  (Capable)  │         │  (Capable)  │      │
│  │ Budget: 40k │         │ Budget: 40k │         │ Budget: 40k │      │
│  └──────┬──────┘         └──────┬──────┘         └──────┬──────┘      │
│         │                       │                       │              │
│         └───────────────────────┼───────────────────────┘              │
│                                 │                                       │
│                                 ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                 CONVERSATION SUMMARY INDEX                       │   │
│  │              (Redis - Short-Term Memory)                        │   │
│  │  session:{id}:summary  ──►  Decisions, topics, files            │   │
│  │  session:{id}:timeline ──►  Ordered events                      │   │
│  │  topic:{name}          ──►  Session index                       │   │
│  └──────────────────────────────┬──────────────────────────────────┘   │
│                                 │                                       │
│                                 ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    CLAUDE.md SYNC                                │   │
│  │              (.claude/rules/attune/)                           │   │
│  │  bug-patterns.md, security-decisions.md, tech-debt-hotspots.md  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```
