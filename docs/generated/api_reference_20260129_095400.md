# Empathy Framework - Cross-Platform Utilities API Reference

**Version:** 1.0  
**Module:** `empathy_os.platform_utils`  
**License:** Fair Source License 0.9  
**Copyright:** 2025 Smart-AI-Memory

---

## Table of Contents

1. [Overview & Introduction](#1-overview--introduction)
2. [Platform Detection Functions](#2-platform-detection-functions)
3. [Directory Utilities](#3-directory-utilities)
4. [Asyncio Configuration](#4-asyncio-configuration)
5. [File Handling Utilities](#5-file-handling-utilities)
6. [Complete API Reference](#6-complete-api-reference)
7. [Best Practices & Patterns](#7-best-practices--patterns)
8. [Troubleshooting](#8-troubleshooting)

---

## 1. Overview & Introduction

### 1.1 Purpose

The `empathy_os.platform_utils` module provides cross-platform utilities for the Empathy Framework, abstracting platform-specific differences to ensure consistent behavior across Windows, macOS, and Linux systems.

**Core Capabilities:**

| Capability | Description |
|------------|-------------|
| **Platform Detection** | Identify the operating system at runtime |
| **Directory Management** | Get platform-appropriate directories for logs, data, config, and cache |
| **Asyncio Configuration** | Handle platform-specific event loop requirements |
| **File Operations** | Ensure consistent file encoding across platforms |

**Why Cross-Platform Utilities Matter:**

- **Consistency**: Applications follow platform conventions automatically
- **Compatibility**: Abstract filesystem layouts and API differences
- **Maintainability**: Centralized platform logic eliminates code duplication
- **User Experience**: Files stored in expected, discoverable locations

### 1.2 Quick Start

```python
#!/usr/bin/env python3
"""Quick start example for empathy_os.platform_utils."""

from empathy_os.platform_utils import (
    get_default_log_dir,
    get_default_data_dir,
    get_default_config_dir,
    setup_asyncio_policy,
    is_windows,
    is_macos,
    is_linux,
    safe_run_async,
)

# Step 1: Initialize platform-specific asyncio settings
# IMPORTANT: Call this early in application startup, before any asyncio.run()
setup_asyncio_policy()

# Step 2: Get platform-appropriate directories
log_dir = get_default_log_dir()
data_dir = get_default_data_dir()
config_dir = get_default_config_dir()

# Step 3: Create directories if they don't exist
for directory in [log_dir, data_dir, config_dir]:
    directory.mkdir(parents=True, exist_ok=True)
    print(f"Initialized: {directory}")

# Step 4: Display platform information
print(f"\nPlatform: ", end="")
if is_windows():
    print("Windows")
elif is_macos():
    print("macOS")
elif is_linux():
    print("Linux")
else:
    print("Unknown Unix-like")

# Step 5: Run async code safely across platforms
async def initialize_application():
    """Example async initialization."""
    print("\nInitializing application...")
    # Your async initialization code here
    return {"status": "ready", "log_dir": str(log_dir)}

result = safe_run_async(initialize_application())
print(f"Result: {result}")
```

**Expected Output (Linux):**
```
Initialized: /home/user/.local/share/empathy/logs
Initialized: /home/user/.local/share/empathy
Initialized: /home/user/.config/empathy

Platform: Linux

Initializing application...
Result: {'status': 'ready', 'log_dir': '/home/user/.local/share/empathy/logs'}
```

### 1.3 Installation & Requirements

**Python Version:**
- Python 3.10 or higher required
- Type hints use modern union syntax (`str | Path`)

**Dependencies:**
```python
# Standard library only - no external dependencies required
import asyncio
import os
import platform
from pathlib import Path
from typing import Any
```

**Import Patterns:**

```python
# Pattern 1: Import specific functions (recommended)
from empathy_os.platform_utils import (
    is_windows,
    is_macos,
    is_linux,
    get_default_log_dir,
    get_default_data_dir,
    get_default_config_dir,
    get_default_cache_dir,
    setup_asyncio_policy,
    safe_run_async,
    open_text_file,
)

# Pattern 2: Import module with alias
import empathy_os.platform_utils as pu

log_dir = pu.get_default_log_dir()
if pu.is_windows():
    pu.setup_asyncio_policy()

# Pattern 3: Import all (not recommended for production)
from empathy_os.platform_utils import *
```

**Internal Dependencies:**
The module imports `_validate_file_path` from `empathy_os.config` for path validation in file operations.

### 1.4 Module Structure

```
empathy_os.platform_utils
│
├── Platform Detection
│   ├── is_windows()      → bool
│   ├── is_macos()        → bool
│   └── is_linux()        → bool
│
├── Directory Utilities
│   ├── get_default_log_dir()    → Path
│   ├── get_default_data_dir()   → Path
│   ├── get_default_config_dir() → Path
│   └── get_default_cache_dir()  → Path
│
├── Asyncio Configuration
│   ├── setup_asyncio_policy()   → None
│   └── safe_run_async()         → Any
│
└── File Handling
    └── open_text_file()         → TextIO
```

---

## 2. Platform Detection Functions

### 2.1 `is_windows()`

```python
def is_windows() -> bool:
    """Check if running on Windows."""
    return platform.system() == "Windows"
```

**Description:**  
Detects if the current platform is Windows by checking the system