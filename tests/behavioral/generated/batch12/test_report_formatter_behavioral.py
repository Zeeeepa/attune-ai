"""Behavioral tests for report_formatter.

Generated by enhanced autonomous test generation system.

Copyright 2026 Smart-AI-Memory
Licensed under Apache 2.0
"""

# Import using module approach to avoid package initialization issues
import attune.workflows.document_gen.report_formatter as report_formatter_module

format_doc_gen_report = report_formatter_module.format_doc_gen_report


class TestFormatDocGenReport:
    """Behavioral tests for format_doc_gen_report function."""

    def test_basic_report_generation_with_minimal_data(self):
        """
        Given minimal result and input data
        When format_doc_gen_report is called
        Then a basic formatted report should be generated with header and statistics
        """
        # Given
        result = {
            "doc_type": "api_reference",
            "audience": "developers",
            "document": "# API Documentation\n\nThis is the API documentation.",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "DOCUMENTATION GENERATION REPORT" in report
        assert "Document Type: Api Reference" in report
        assert "Target Audience: Developers" in report
        assert "GENERATED DOCUMENTATION" in report
        assert "# API Documentation" in report
        assert "STATISTICS" in report
        assert "Word Count:" in report
        assert "Section Count:" in report

    def test_report_with_outline_preview(self):
        """
        Given input data with an outline
        When format_doc_gen_report is called
        Then the outline should be included in the report with preview
        """
        # Given
        result = {
            "doc_type": "user_guide",
            "audience": "end_users",
            "document": "User guide content",
        }
        input_data = {
            "outline": "1. Introduction\n2. Getting Started\n3. Features\n4. Advanced Usage",
        }

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "DOCUMENT OUTLINE" in report
        assert "1. Introduction" in report
        assert "2. Getting Started" in report

    def test_report_with_long_outline_shows_preview_and_ellipsis(self):
        """
        Given input data with an outline longer than 10 lines
        When format_doc_gen_report is called
        Then only first 10 lines should be shown with ellipsis
        """
        # Given
        result = {
            "doc_type": "tutorial",
            "audience": "beginners",
            "document": "Tutorial content",
        }
        outline_lines = [f"Line {i}" for i in range(1, 15)]
        input_data = {"outline": "\n".join(outline_lines)}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Line 1" in report
        assert "Line 10" in report
        assert "Line 11" not in report
        assert "..." in report

    def test_report_with_empty_document(self):
        """
        Given result with empty document
        When format_doc_gen_report is called
        Then statistics should show zero counts
        """
        # Given
        result = {
            "doc_type": "reference",
            "audience": "developers",
            "document": "",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Word Count: 0" in report
        assert "Section Count: ~0" in report

    def test_report_with_markdown_headers_counts_sections(self):
        """
        Given document with markdown headers
        When format_doc_gen_report is called
        Then section count should reflect number of ## headers
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": "# Title\n## Section 1\n## Section 2\n## Section 3\nContent",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Section Count: ~3" in report

    def test_report_with_chunked_generation_mode(self):
        """
        Given input data indicating chunked generation
        When format_doc_gen_report is called
        Then report should show chunked generation mode
        """
        # Given
        result = {
            "doc_type": "documentation",
            "audience": "developers",
            "document": "Content",
        }
        input_data = {
            "chunked": True,
            "chunk_count": 5,
            "chunks_completed": 5,
        }

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Generation Mode: Chunked (5 chunks)" in report

    def test_report_with_chunked_generation_stopped_early(self):
        """
        Given input data indicating chunked generation stopped early
        When format_doc_gen_report is called
        Then report should show partial completion
        """
        # Given
        result = {
            "doc_type": "documentation",
            "audience": "developers",
            "document": "Partial content",
        }
        input_data = {
            "chunked": True,
            "chunk_count": 10,
            "chunks_completed": 7,
            "stopped_early": True,
        }

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Generation Mode: Chunked (7/10 chunks completed)" in report

    def test_report_with_polish_chunked_mode(self):
        """
        Given result indicating polish was chunked
        When format_doc_gen_report is called
        Then report should show polish chunked mode
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": "Polished content",
            "polish_chunked": True,
            "polish_chunks": 3,
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Polish Mode: Chunked (3 sections)" in report

    def test_report_with_accumulated_cost(self):
        """
        Given result with accumulated cost
        When format_doc_gen_report is called
        Then report should show estimated cost formatted to 2 decimals
        """
        # Given
        result = {
            "doc_type": "reference",
            "audience": "developers",
            "document": "Content",
            "accumulated_cost": 1.2345,
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Estimated Cost: $1.23" in report

    def test_report_with_zero_accumulated_cost_omits_cost(self):
        """
        Given result with zero accumulated cost
        When format_doc_gen_report is called
        Then cost line should not be included
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": "Content",
            "accumulated_cost": 0,
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Estimated Cost:" not in report

    def test_report_with_export_path(self):
        """
        Given result with export path
        When format_doc_gen_report is called
        Then report should include FILE EXPORT section
        """
        # Given
        result = {
            "doc_type": "documentation",
            "audience": "developers",
            "document": "Content",
            "export_path": "/path/to/exported/file.md",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "FILE EXPORT" in report

    def test_report_without_export_path_omits_export_section(self):
        """
        Given result without export path
        When format_doc_gen_report is called
        Then FILE EXPORT section should not be included
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": "Content",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "FILE EXPORT" not in report

    def test_report_formats_doc_type_with_underscores_replaced(self):
        """
        Given doc_type with underscores
        When format_doc_gen_report is called
        Then underscores should be replaced with spaces and title cased
        """
        # Given
        result = {
            "doc_type": "api_reference_guide",
            "audience": "developers",
            "document": "Content",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Document Type: Api Reference Guide" in report

    def test_report_with_default_values_for_missing_fields(self):
        """
        Given result and input_data with missing optional fields
        When format_doc_gen_report is called
        Then defaults should be used without errors
        """
        # Given
        result = {}
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Document Type: General" in report
        assert "Target Audience: Developers" in report
        assert "Word Count: 0" in report
        assert "Section Count: ~0" in report

    def test_report_word_count_calculation(self):
        """
        Given document with specific word count
        When format_doc_gen_report is called
        Then word count should be accurately calculated
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": "This is a test document with exactly ten words here.",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Word Count: 10" in report

    def test_report_with_all_features_combined(self):
        """
        Given result and input_data with all features
        When format_doc_gen_report is called
        Then comprehensive report with all sections should be generated
        """
        # Given
        result = {
            "doc_type": "technical_guide",
            "audience": "advanced_users",
            "document": "## Introduction\n## Setup\n## Usage\nDetailed content here.",
            "accumulated_cost": 2.5,
            "polish_chunked": True,
            "polish_chunks": 4,
            "export_path": "/docs/output.md",
        }
        input_data = {
            "outline": "1. Intro\n2. Setup\n3. Usage",
            "chunked": True,
            "chunk_count": 3,
            "chunks_completed": 3,
            "stopped_early": False,
        }

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "DOCUMENTATION GENERATION REPORT" in report
        assert "Document Type: Technical Guide" in report
        assert "Target Audience: Advanced Users" in report
        assert "DOCUMENT OUTLINE" in report
        assert "GENERATED DOCUMENTATION" in report
        assert "STATISTICS" in report
        assert "Generation Mode: Chunked (3 chunks)" in report
        assert "Polish Mode: Chunked (4 sections)" in report
        assert "Estimated Cost: $2.50" in report
        assert "FILE EXPORT" in report
        assert "Section Count: ~3" in report

    def test_report_structure_with_separators(self):
        """
        Given any valid input
        When format_doc_gen_report is called
        Then report should contain proper section separators
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": "Content",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "=" * 60 in report
        assert "-" * 60 in report

    def test_report_with_multiline_document(self):
        """
        Given document with multiple lines and formatting
        When format_doc_gen_report is called
        Then entire document should be preserved in report
        """
        # Given
        multiline_doc = """# Title

This is a paragraph.

## Section 1

Content for section 1.

## Section 2

Content for section 2."""

        result = {
            "doc_type": "manual",
            "audience": "users",
            "document": multiline_doc,
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "# Title" in report
        assert "This is a paragraph." in report
        assert "## Section 1" in report
        assert "Content for section 1." in report

    def test_report_with_special_characters_in_document(self):
        """
        Given document with special characters
        When format_doc_gen_report is called
        Then special characters should be preserved
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": "Special chars: @#$%^&*()_+-=[]{}|;':\",./<>?",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "@#$%^&*()_+-=[]{}|;':\",./<>?" in report

    def test_report_audience_title_case_formatting(self):
        """
        Given audience in lowercase
        When format_doc_gen_report is called
        Then audience should be title cased
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "advanced developers",
            "document": "Content",
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Target Audience: Advanced Developers" in report

    def test_report_returns_string_type(self):
        """
        Given any valid inputs
        When format_doc_gen_report is called
        Then return value should be a string
        """
        # Given
        result = {"document": "Content"}
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert isinstance(report, str)

    def test_report_with_none_document_field(self):
        """
        Given result with None as document value
        When format_doc_gen_report is called
        Then should handle gracefully with zero counts
        """
        # Given
        result = {
            "doc_type": "guide",
            "audience": "users",
            "document": None,
        }
        input_data = {}

        # When
        report = format_doc_gen_report(result, input_data)

        # Then
        assert "Word Count: 0" in report
        assert "Section Count: ~0" in report
