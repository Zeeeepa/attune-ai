"""Behavioral tests for domain_templates.

Generated by enhanced autonomous test generation system.

Copyright 2026 Smart-AI-Memory
Licensed under Apache 2.0
"""

import pytest
from dataclasses import FrozenInstanceError
from typing import Any

from empathy_os.socratic.domain_templates import (
    Domain,
    AgentTemplate,
    WorkflowTemplate,
)
from empathy_os.socratic.blueprint import AgentRole


# =============================================================================
# FIXTURES
# =============================================================================


@pytest.fixture
def sample_agent_configuration() -> dict[str, Any]:
    """Provide sample agent configuration."""
    return {
        "temperature": 0.7,
        "max_tokens": 2000,
        "timeout": 30,
    }


@pytest.fixture
def sample_agent_template(sample_agent_configuration) -> AgentTemplate:
    """Provide a sample agent template."""
    return AgentTemplate(
        template_id="code_review_001",
        name="Code Review Agent",
        description="Agent for reviewing code quality",
        role=AgentRole.REVIEWER,
        tools=["static_analyzer", "linter", "code_metrics"],
        model_tier="capable",
        system_prompt="You are a code review expert.",
        example_prompts=["Review this function", "Check for bugs"],
        configuration=sample_agent_configuration,
        tags=["code", "review", "quality"],
    )


@pytest.fixture
def minimal_agent_template() -> AgentTemplate:
    """Provide a minimal agent template with default values."""
    return AgentTemplate(
        template_id="minimal_001",
        name="Minimal Agent",
        description="Minimal configuration",
        role=AgentRole.EXECUTOR,
        tools=[],
    )


@pytest.fixture
def sample_workflow_template() -> WorkflowTemplate:
    """Provide a sample workflow template."""
    return WorkflowTemplate()


# =============================================================================
# DOMAIN ENUM TESTS
# =============================================================================


class TestDomain:
    """Tests for Domain enum."""

    def test_given_domain_enum_when_accessing_code_review_then_returns_correct_value(self):
        """
        Given: The Domain enum
        When: Accessing CODE_REVIEW member
        Then: Returns correct string value
        """
        # When
        domain = Domain.CODE_REVIEW

        # Then
        assert domain.value == "code_review"
        assert domain.name == "CODE_REVIEW"

    def test_given_domain_enum_when_accessing_all_software_domains_then_all_exist(self):
        """
        Given: The Domain enum
        When: Accessing all software development domains
        Then: All expected domains exist
        """
        # When/Then
        assert Domain.CODE_REVIEW.value == "code_review"
        assert Domain.TESTING.value == "testing"
        assert Domain.REFACTORING.value == "refactoring"
        assert Domain.DOCUMENTATION.value == "documentation"
        assert Domain.PERFORMANCE.value == "performance"

    def test_given_domain_enum_when_accessing_security_domains_then_all_exist(self):
        """
        Given: The Domain enum
        When: Accessing all security domains
        Then: All expected domains exist
        """
        # When/Then
        assert Domain.SECURITY_AUDIT.value == "security_audit"
        assert Domain.VULNERABILITY_SCAN.value == "vulnerability_scan"
        assert Domain.COMPLIANCE.value == "compliance"
        assert Domain.PENETRATION_TESTING.value == "penetration_testing"

    def test_given_domain_enum_when_accessing_data_science_domains_then_all_exist(self):
        """
        Given: The Domain enum
        When: Accessing all data science domains
        Then: All expected domains exist
        """
        # When/Then
        assert Domain.DATA_VALIDATION.value == "data_validation"
        assert Domain.MODEL_EVALUATION.value == "model_evaluation"
        assert Domain.DATA_PIPELINE.value == "data_pipeline"
        assert Domain.REPORTING.value == "reporting"

    def test_given_domain_enum_when_accessing_devops_domains_then_all_exist(self):
        """
        Given: The Domain enum
        When: Accessing all devops domains
        Then: All expected domains exist
        """
        # When/Then
        assert Domain.CI_CD.value == "ci_cd"
        assert Domain.INFRASTRUCTURE.value == "infrastructure"
        assert Domain.MONITORING.value == "monitoring"
        assert Domain.INCIDENT_RESPONSE.value == "incident_response"

    def test_given_domain_enum_when_accessing_legal_domains_then_all_exist(self):
        """
        Given: The Domain enum
        When: Accessing all legal domains
        Then: All expected domains exist
        """
        # When/Then
        assert Domain.CONTRACT_REVIEW.value == "contract_review"
        assert Domain.LEGAL_COMPLIANCE.value == "legal_compliance"
        assert Domain.IP_ANALYSIS.value == "ip_analysis"

    def test_given_domain_enum_when_accessing_healthcare_domains_then_all_exist(self):
        """
        Given: The Domain enum
        When: Accessing all healthcare domains
        Then: All expected domains exist
        """
        # When/Then
        assert Domain.CLINICAL_NOTES.value == "clinical_notes"
        assert Domain.HIPAA_COMPLIANCE.value == "hipaa_compliance"
        assert Domain.MEDICAL_CODING.value == "medical_coding"

    def test_given_domain_enum_when_accessing_financial_domains_then_all_exist(self):
        """
        Given: The Domain enum
        When: Accessing all financial domains
        Then: All expected domains exist
        """
        # When/Then
        assert Domain.RISK_ANALYSIS.value == "risk_analysis"
        assert Domain.FRAUD_DETECTION.value == "fraud_detection"
        assert Domain.FINANCIAL_REPORTING.value == "financial_reporting"

    def test_given_domain_enum_when_accessing_general_domain_then_exists(self):
        """
        Given: The Domain enum
        When: Accessing GENERAL domain
        Then: Domain exists with correct value
        """
        # When/Then
        assert Domain.GENERAL.value == "general"

    def test_given_domain_value_when_converting_from_string_then_returns_enum(self):
        """
        Given: A domain value string
        When: Converting to Domain enum
        Then: Returns correct enum member
        """
        # Given
        domain_string = "code_review"

        # When
        domain = Domain(domain_string)

        # Then
        assert domain == Domain.CODE_REVIEW

    def test_given_invalid_domain_value_when_converting_from_string_then_raises_error(self):
        """
        Given: An invalid domain value string
        When: Converting to Domain enum
        Then: Raises ValueError
        """
        # Given
        invalid_domain = "invalid_domain"

        # When/Then
        with pytest.raises(ValueError):
            Domain(invalid_domain)

    def test_given_domain_enum_when_iterating_all_members_then_count_is_correct(self):
        """
        Given: The Domain enum
        When: Iterating through all members
        Then: Total count matches expected
        """
        # When
        all_domains = list(Domain)

        # Then
        # 5 software + 4 security + 4 data science + 4 devops + 3 legal + 3 healthcare + 3 financial + 1 general
        assert len(all_domains) == 27

    def test_given_domain_enum_when_checking_membership_then_works_correctly(self):
        """
        Given: The Domain enum
        When: Checking if value is in enum
        Then: Membership check works correctly
        """
        # When/Then
        assert Domain.CODE_REVIEW in Domain
        assert "not_a_domain" not in [d.value for d in Domain]


# =============================================================================
# AGENTTEMPLATE TESTS
# =============================================================================


class TestAgentTemplate:
    """Tests for AgentTemplate dataclass."""

    def test_given_all_required_fields_when_creating_agent_template_then_succeeds(
        self, sample_agent_template
    ):
        """
        Given: All required fields for an agent template
        When: Creating an AgentTemplate instance
        Then: Instance is created successfully with correct values
        """
        # Then
        assert sample_agent_template.template_id == "code_review_001"
        assert sample_agent_template.name == "Code Review Agent"
        assert sample_agent_template.description == "Agent for reviewing code quality"
        assert sample_agent_template.role == AgentRole.REVIEWER
        assert sample_agent_template.tools == ["static_analyzer", "linter", "code_metrics"]
        assert sample_agent_template.model_tier == "capable"
        assert sample_agent_template.system_prompt == "You are a code review expert."
        assert sample_agent_template.example_prompts == ["Review this function", "Check for bugs"]
        assert "temperature" in sample_agent_template.configuration
        assert sample_agent_template.tags == ["code", "review", "quality"]

    def test_given_minimal_fields_when_creating_agent_template_then_uses_defaults(
        self, minimal_agent_template
    ):
        """
        Given: Only required fields for an agent template
        When: Creating an AgentTemplate instance
        Then: Optional fields use default values
        """
        # Then
        assert minimal_agent_template.template_id == "minimal_001"
        assert minimal_agent_template.name == "Minimal Agent"
        assert minimal_agent_template.model_tier == "capable"
        assert minimal_agent_template.system_prompt == ""
        assert minimal_agent_template.example_prompts == []
        assert minimal_agent_template.configuration == {}
        assert minimal_agent_template.tags == []

    def test_given_agent_template_when_accessing_model_tier_then_returns_correct_value(
        self, sample_agent_template
    ):
        """
        Given: An agent template with model tier
        When: Accessing model_tier attribute
        Then: Returns correct value
        """
        # When
        tier = sample_agent_template.model_tier

        # Then
        assert tier == "capable"

    def test_given_agent_template_when_modifying_tools_list_then_changes_persist(
        self, sample_agent_template
    ):
        """
        Given: An agent template with tools
        When: Modifying the tools list
        Then: Changes are reflected in the template
        """
        # Given
        initial_tools = sample_agent_template.tools.copy()

        # When
        sample_agent_template.tools.append("new_tool")

        # Then
        assert len(sample_agent_template.tools) == len(initial_tools) + 1
        assert "new_tool" in sample_agent_template.tools

    def test_given_agent_template_when_modifying_configuration_then_changes_persist(
        self, sample_agent_template
    ):
        """
        Given: An agent template with configuration
        When: Modifying the configuration dict
        Then: Changes are reflected in the template
        """
        # Given
        initial_keys = list(sample_agent_template.configuration.keys())

        # When
        sample_agent_template.configuration["new_key"] = "new_value"

        # Then
        assert "new_key" in sample_agent_template.configuration
        assert sample_agent_template.configuration["new_key"] == "new_value"

    def test_given_agent_template_when_checking_equality_then_compares_correctly(self):
        """
        Given: Two agent templates
        When: Comparing for equality
        Then: Returns correct comparison result
        """
        # Given
        template1 = AgentTemplate(
            template_id="test_001",
            name="Test Agent",
            description="Test description",
            role=AgentRole.EXECUTOR,
            tools=["tool1"],
        )
        template2 = AgentTemplate(
            template_id="test_001",
            name="Test Agent",
            description="Test description",
            role=AgentRole.EXECUTOR,
            tools=["tool1"],
        )
        template3 = AgentTemplate(
            template_id="test_002",
            name="Different Agent",
            description="Different description",
            role=AgentRole.REVIEWER,
            tools=["tool2"],
        )

        # When/Then
        assert template1 == template2
        assert template1 != template3

    def test_given_different_model_tiers_when_creating_templates_then_all_valid(self):
        """
        Given: Different model tier values
        When: Creating agent templates
        Then: All tier values are accepted
        """
        # Given/When
        cheap_template = AgentTemplate(
            template_id="cheap_001",
            name="Cheap Agent",
            description="Budget agent",
            role=AgentRole.EXECUTOR,
            tools=[],
            model_tier="cheap",
        )
        capable_template = AgentTemplate(
            template_id="capable_001",
            name="Capable Agent",
            description="Standard agent",
            role=AgentRole.EXECUTOR,
            tools=[],
            model_tier="capable",
        )
        premium_template = AgentTemplate(
            template_id="premium_001",
            name="Premium Agent",
            description="High-end agent",
            role=AgentRole.EXECUTOR,
            tools=[],
            model_tier="premium",
        )

        # Then
        assert cheap_template.model_tier == "cheap"
        assert capable_template.model_tier == "capable"
        assert premium_template.model_tier == "premium"

    def test_given_agent_template_when_converting_to_dict_then_contains_all_fields(
        self, sample_agent_template
    ):
        """
        Given: An agent template
        When: Converting to dictionary
        Then: Dictionary contains all fields
        """
        # When
        from dataclasses import asdict

        template_dict = asdict(sample_agent_template)

        # Then
        assert "template_id" in template_dict
        assert "name" in template_dict
        assert "description" in template_dict
        assert "role" in template_dict
        assert "tools" in template_dict
        assert "model_tier" in template_dict
        assert "system_prompt" in template_dict
        assert "example_prompts" in template_dict
        assert "configuration" in template_dict
        assert "tags" in template_dict

    def test_given_empty_tools_list_when_creating_template_then_accepts_empty_list(self):
        """
        Given: An empty tools list
        When: Creating agent template
        Then: Template accepts empty list
        """
        # Given/When
        template = AgentTemplate(
            template_id="no_tools_001",
            name="No Tools Agent",
            description="Agent without tools",
            role=AgentRole.OBSERVER,
            tools=[],
        )

        # Then
        assert template.tools == []
        assert isinstance(template.tools, list)

    def test_given_complex_configuration_when_creating_template_then_stores_nested_data(self):
        """
        Given: A complex nested configuration
        When: Creating agent template
        Then: Configuration stores nested data correctly
        """
        # Given
        complex_config = {
            "llm": {"temperature": 0.7, "max_tokens": 2000},
            "tools": {"timeout": 30, "retry": 3},
            "features": ["feature1", "feature2"],
        }

        # When
        template = AgentTemplate(
            template_id="complex_001",
            name="Complex Agent",
            description="Agent with complex config",
            role=AgentRole.EXECUTOR,
            tools=["tool1"],
            configuration=complex_config,
        )

        # Then
        assert template.configuration["llm"]["temperature"] ==